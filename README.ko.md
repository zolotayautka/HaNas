# HaNas

**한국어** | [日本語](./README.ja.md) | [English](./README.md)

웹과 네이티브 모바일 클라이언트를 갖춘 가볍고 안전한 파일 관리 시스템입니다. 모든 기기에서 파일을 업로드하고, 정리하고, 공유하고, 미디어를 스트리밍하세요.

## 🌟 주요 기능

### 핵심 기능
- 📁 **파일 관리**: 폴더 생성, 파일 업로드, 복사, 이동, 이름 변경 및 삭제
- 🔐 **사용자 인증**: JWT 기반의 안전한 인증 및 회원가입
- 🎵 **미디어 재생**: 일반적인 형식의 오디오 및 비디오 플레이어 내장
- 🖼️ **썸네일 생성**: 이미지 및 비디오 자동 썸네일 생성
- 🔗 **파일 공유**: 고유한 공유 링크로 파일 및 폴더 공유
- 📊 **업로드 진행률**: Multipart 지원과 실시간 업로드 진행률 추적
- 🔄 **파일 덮어쓰기**: 재업로드 시 기존 파일 자동 업데이트
- 🌍 **다국어 지원**: 일본어, 한국어, 영어 지원

### 플랫폼 지원
- 🌐 **웹 인터페이스**: 드래그 앤 드롭 지원 반응형 웹 UI
- 📱 **iOS 네이티브 클라이언트**: iPhone 및 iPad용 완전한 기능의 SwiftUI 앱
- 💻 **macOS 네이티브 클라이언트**: 네이티브 Mac 애플리케이션
- 📦 **단일 바이너리 서버**: 모든 자원이 내장되어 외부 종속성 없음

## 지원 미디어 형식

**오디오**: MP3, M4A, WAV, OGG, FLAC, AAC  
**비디오**: MP4, WebM, OGG, MOV, MKV  
**이미지**: JPG, PNG, GIF, WebP (썸네일 지원)

## 🚀 설치

### 서버 설정

#### 필수 요구사항
- Go 1.16 이상

#### 소스에서 빌드

```bash
git clone https://github.com/yourusername/HaNas.git
cd HaNas/server
go build -o hanas
```

#### 사용법

1. 서버 시작:
```bash
./hanas
```

2. 브라우저를 열고 다음으로 이동:
```
http://localhost:8080
```

3. 새 계정을 등록하고 파일 관리를 시작하세요!

### iOS 클라이언트 설정

#### 필수 요구사항
- iOS 15.0 이상
- Xcode 14.0 이상
- Swift 5.7 이상

#### 설치

1. Xcode에서 `client/hanas for ios/Hanas for ios.xcodeproj` 열기
2. 서명 설정에서 개발 팀 선택
3. 기기 또는 시뮬레이터에서 빌드 및 실행

#### 사용법

1. 앱 실행
2. HaNas 서버 URL 입력 (예: `http://192.168.1.100`)
3. 자격 증명으로 로그인하거나 새 계정 등록
4. 네이티브 iOS 인터페이스로 파일 탐색 및 관리

### macOS 클라이언트 설정

1. Xcode에서 `client/HaNas for Mac/HaNas for Mac.xcodeproj` 열기
2. 네이티브 Mac 애플리케이션 빌드 및 실행

## ⚙️ 구성

### 서버 구성
- **포트**: 기본값 `8080` (`main()` 함수에서 수정)
- **데이터 디렉토리**: `./data` (파일 저장 위치)
- **썸네일 디렉토리**: `./thumbnails` (썸네일 캐시)
- **데이터베이스**: `./database.db` (SQLite 데이터베이스)
- **JWT 비밀키**: 프로덕션에서 구성 (보안 섹션 참조)

### iOS 클라이언트 구성
- **서버 URL**: 첫 로그인 시 구성
- **자격 증명**: SQLite를 사용하여 앱의 Documents 디렉토리에 안전하게 저장
- **자동 로그인**: 앱 실행 시 자동 인증

## 📡 API 엔드포인트

자세한 API 문서는 [API_README.md](./API_README.md)를 참조하세요

### 인증
- `POST /register` - 새 사용자 계정 생성
- `POST /login` - 로그인 및 JWT 토큰 수신
- `POST /logout` - 로그아웃 및 토큰 지우기
- `GET /me` - 현재 사용자 정보 가져오기

### 파일 작업
- `GET /node/:id` - 노드 정보 및 하위 항목 가져오기
- `GET /file/:id` - 파일 다운로드 또는 스트리밍
- `GET /thumbnail/:id` - 이미지/비디오 썸네일 가져오기
- `POST /upload` - 파일 업로드 또는 폴더 생성 (multipart 지원)
- `POST /copy` - 파일/폴더 복사
- `POST /move` - 파일/폴더 이동
- `POST /rename` - 파일/폴더 이름 변경
- `POST /delete` - 파일/폴더 삭제

### 공유
- `POST /share/create` - 노드에 대한 공유 링크 생성
- `POST /share/delete` - 공유 링크 삭제
- `GET /s/:token` - 공유된 노드 접근 (인증 불필요)
- `GET /share/:token/download` - 공유된 파일 다운로드

### 진행률 추적
- `GET /progress/:upload_id` - 업로드 진행률 가져오기 (0-100)

## 📂 프로젝트 구조

```
HaNas/
├── server/              # 백엔드 서버
│   ├── app.go          # 모든 API 엔드포인트가 있는 메인 서버 로직
│   ├── go.mod          # Go 모듈 의존성
│   ├── index.html      # 웹 인터페이스
│   ├── index.js        # 프론트엔드 로직
│   └── i18n.js         # 국제화
├── client/             # 네이티브 클라이언트 애플리케이션
│   ├── hanas for ios/  # iOS 네이티브 클라이언트
│   │   └── hanas for ios/
│   │       ├── HaNas_iOSApp.swift      # 앱 진입점
│   │       ├── AppState.swift          # 전역 앱 상태
│   │       ├── ConfigManager.swift     # 구성 저장소
│   │       ├── ContentView.swift       # 메인 뷰
│   │       ├── LoginView.swift         # 인증 UI
│   │       ├── FileListView.swift      # 파일 브라우저
│   │       └── exec.swift              # API 클라이언트
│   └── HaNas for Mac/  # macOS 네이티브 클라이언트
├── bin/                # 컴파일된 바이너리 및 빌드
├── data/               # 사용자 파일 저장소 (자동 생성)
├── thumbnails/         # 썸네일 캐시 (자동 생성)
└── database.db         # SQLite 데이터베이스 (자동 생성)
```

## 🔧 기술 세부사항

### 백엔드 (서버)
- **언어**: Go
- **데이터베이스**: GORM을 사용한 SQLite
- **인증**: HTTP-only 쿠키를 사용한 JWT (24시간 만료)
- **주요 기능**: 
  - 사용자 인증 및 등록
  - Range 요청 지원 파일 스트리밍
  - 실시간 업로드 진행률 추적
  - 이미지 및 비디오 자동 썸네일 생성
  - 토큰 기반 액세스로 공유 가능한 링크
  - MIME 타입 감지
  - 계단식 삭제가 있는 계층적 폴더 구조
  - 뮤텍스 잠금으로 동시 업로드 처리
  - Base64 및 multipart 파일 업로드 지원

### 웹 프론트엔드
- **기술**: 바닐라 JavaScript (프레임워크 없음)
- **기능**:
  - 드래그 앤 드롭 파일 업로드
  - SSE를 사용한 실시간 업로드 진행률
  - 통합 미디어 플레이어
  - 이미지 썸네일 미리보기
  - 파일 공유 UI
  - 반응형 그리드 레이아웃
  - 브라우저 언어 감지

### iOS 클라이언트
- **언어**: Swift 5.7+
- **프레임워크**: SwiftUI
- **타겟**: iOS 15.0+
- **아키텍처**: Combine을 사용한 MVVM
- **주요 기능**:
  - 네이티브 iOS 파일 선택기 통합
  - 사진 라이브러리 액세스
  - 모든 파일 유형에 대한 문서 선택기
  - PDF 미리보기 지원
  - AVKit을 사용한 비디오/오디오 플레이어
  - 그리드 기반 파일 탐색
  - 컨텍스트 메뉴 작업 (복사, 잘라내기, 붙여넣기, 삭제, 이름 변경)
  - 안전한 저장소를 사용한 영구 인증
  - 다국어 지원 (en, ja, ko)
  - 썸네일 캐싱

### macOS 클라이언트
- **언어**: Swift
- **프레임워크**: SwiftUI
- **타겟**: macOS 12.0+
- **기능**: Mac에 최적화된 UI를 사용한 iOS 클라이언트와 유사
## 🌍 언어 지원

인터페이스는 브라우저/기기 언어를 자동으로 감지하고 다음 언어로 표시됩니다:
- 🇯🇵 **일본어** (ja) - 日本語
- 🇰🇷 **한국어** (ko) - 기본값
- 🇬🇧 **영어** (en)

### 지원 플랫폼
- 웹 인터페이스 (브라우저 언어 감지)
- iOS 앱 (기기 언어 설정)
- macOS 앱 (시스템 언어 설정)

## 🔐 보안 기능

- **비밀번호 해싱**: 비용 계수 14의 bcrypt
- **JWT 인증**: 24시간 만료의 HTTP-only 쿠키
- **안전한 토큰 저장**: 플랫폼별 안전한 저장소 (iOS/Mac)
- **파일 접근 제어**: 사용자 기반 파일 격리
- **공유 토큰**: UUID 기반 공유 가능한 링크
- **API 권한 부여**: 모든 보호된 엔드포인트에 미들웨어 기반 인증

## 🛡️ 프로덕션 보안 고려사항

⚠️ **이것은 개인/개발 사용을 위해 설계되었습니다**. 프로덕션 배포를 위해:

### 필수 보안 업데이트
1. **JWT 비밀키 변경**: `app.go`의 `jwtSecret`을 강력하고 무작위한 값으로 업데이트
2. **HTTPS 활성화**: TLS/SSL 인증서 지원 추가
3. **속도 제한 추가**: 인증에 대한 무차별 대입 공격 방지
4. **파일 업로드 제한**: 최대 파일 크기 및 동시 업로드 설정
5. **입력 살균**: 파일 이름 및 경로 검증 강화
6. **CORS 구성**: 교차 출처 요청 제한
7. **환경 변수**: 비밀을 환경 구성으로 이동
8. **데이터베이스 보안**: 적절한 데이터베이스 자격 증명 및 암호화 사용
9. **감사 로깅**: 보안 이벤트에 대한 포괄적인 로깅 구현
10. **종속성 업데이트**: Go 모듈에 대한 정기적인 보안 업데이트

### 네트워크 보안
- 리버스 프록시 뒤에 배포 (nginx, Apache)
- 방화벽 규칙을 사용하여 액세스 제한
- 원격 액세스를 위한 VPN 고려
- HTTPS 전용 연결 활성화

## 🛠️ 개발

### 새 언어 추가

#### 서버 (웹 인터페이스)

1. `server/i18n.js`를 편집하고 언어 코드를 추가하세요:
```javascript
const i18n = {
  // ... 기존 언어
  fr: {
    home: 'Accueil',
    upload: 'Télécharger',
    // ... 모든 번역 추가
  }
};
```

2. `server/index.js`의 언어 감지를 업데이트하세요:
```javascript
if(userLang.startsWith('ja')) lang = 'ja';
else if(userLang.startsWith('ko')) lang = 'ko';
else if(userLang.startsWith('fr')) lang = 'fr'; // 이것을 추가
else lang = 'en';
```

#### iOS/Mac 클라이언트

1. Xcode에서 새 `.lproj` 폴더 추가 (예: `fr.lproj/`)
2. 번역이 포함된 `Localizable.strings` 파일 생성:
```
"app_name" = "HaNas";
"login_title" = "Connexion";
// ... 모든 키 추가
```

### 지원 미디어 형식 수정

`server/index.js`의 `isMediaByName()` 함수를 편집하세요:
```javascript
const audio = ['mp3','m4a','wav','ogg','flac','aac','your-format'];
const video = ['mp4','webm','ogg','mov','mkv','your-format'];
```

## 🐛 문제 해결

### 서버 문제

**문제**: 같은 이름의 폴더와 파일을 업로드할 수 없음  
**해결책**: 충돌을 방지하기 위한 설계입니다. 먼저 파일 또는 폴더 이름을 변경하세요.

**문제**: 미디어 파일이 재생되지 않음  
**해결책**: 파일 형식이 지원되는지 확인하세요. 컨테이너 형식이 나열되어 있어도 브라우저가 모든 코덱을 지원하지 않을 수 있습니다.

**문제**: 업로드 진행률이 0%에서 멈춤  
**해결책**: 브라우저 콘솔에서 오류를 확인하세요. upload_id 매개변수가 올바르게 생성되고 있는지 확인하세요.

### iOS/Mac 클라이언트 문제

**문제**: 서버에 연결할 수 없음  
**해결책**: 
- 서버 URL이 올바른지 확인 (http:// 또는 https:// 포함)
- 기기가 서버와 같은 네트워크에 있는지 확인
- 서버의 방화벽 설정 확인
- 먼저 Safari에서 서버 URL에 접근해 보세요

**문제**: 자격 증명이 맞는데 로그인 실패  
**해결책**: 
- 앱 데이터를 지우고 다시 시도
- 인증 오류에 대한 서버 로그 확인
- JWT 토큰이 쿠키에 설정되고 있는지 확인

## 📄 라이선스

MIT 라이선스

## 🤝 기여

기여를 환영합니다! Pull Request를 자유롭게 제출해 주세요.

## 🙏 감사의 말

- GORM - 데이터베이스 ORM
- JWT - 인증
- FFmpeg - 비디오 썸네일
- nfnt/resize - 이미지 처리

---

Go, Swift 및 바닐라 JavaScript로 ❤️를 담아 제작

**모두를 위한 멀티 플랫폼 파일 관리**
